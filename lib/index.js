!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Signature=e():t.Signature=e()}(self,(function(){return function(){"use strict";var t={d:function(e,n){for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}function u(t,e,n){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}},u(t,e,n||t)}function h(t,e){return h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},h(t,e)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function d(t,e){if(e&&("object"===l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return a(t)}t.r(e),t.d(e,{default:function(){return D}});var f,p,v="ontouchstart"in document,y=navigator.userAgent,m=window.navigator.msPointerEnabled&&/IEMobile/i.test(y);v=v||m||!1,void 0!==document.hidden?(f="hidden",p="visibilitychange"):void 0!==document.msHidden?(f="msHidden",p="msvisibilitychange"):void 0!==document.webkitHidden&&(f="webkitHidden",p="webkitvisibilitychange");var w=m?{START:"MSPointerDown",MOVE:"MSPointerMove",END:"MSPointerCancel",HIDDEN:f,VISIBILITYCHANGE:p}:{START:v?"touchstart":"mousedown",MOVE:v?"touchmove":"mousemove",END:v?"touchend":"mouseup",HIDDEN:f,VISIBILITYCHANGE:p};function g(){}function b(t){return t.changedTouches?t.changedTouches[0]:t}w.RESIZE="onorientationchange"in window?"orientationchange":"resize";var M=function(){function t(){o(this,t)}return r(t,[{key:"init",value:function(){this.resize=this.resize.bind(this),this.attachEvents(),this.resize()}},{key:"resize",value:function(){var t,e,n=this.options,o=n.width,i=n.height,r=n.root;t="auto"===o?r.offsetWidth:o,e="auto"===i?r.offsetHeight:i,this.drawElement.width=t,this.drawElement.height=e,this.drawElement.style.cssText="position:absolute; left: 0; top: 0; width: ".concat(t,"px; height: ").concat(e,"px;"),this.drawElement.style.cssText="position:absolute; left: 0; top: 0; width: ".concat(t,"px; height: ").concat(e,"px;")}},{key:"attachEvents",value:function(){window.addEventListener(w.RESIZE,this.resize,!1)}},{key:"detachEvents",value:function(){window.removeEventListener(w.RESIZE,this.resize,!1)}},{key:"destroy",value:function(){this.detachEvents()}}]),t}();function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function k(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?E(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):E(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var T=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t),this._touchTimer=null,this.options=k(k({},t.defaultOptions),e)}return r(t,[{key:"attach",value:function(t){this.element=t,this._bindEvents()}},{key:"_bindEvents",value:function(){this._onTouchStart=this._onTouchStart.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this.element.addEventListener(w.START,this._onTouchStart,!1),this.element.addEventListener(w.MOVE,this._onTouchMove,!1),this.element.addEventListener(w.END,this._onTouchEnd,!1),this.element.addEventListener("mouseout",this._onMouseOut,!1)}},{key:"_onTouchStart",value:function(t){var e=this;t=b(t),this._startTime=Date.now(),this._clearTouchTimer(),this._setMouseEventXY(t),this.options.onMouseDown(t),this._touchTimer=setTimeout((function(){e.options.onLongTap(t)}),300)}},{key:"_onTouchMove",value:function(t){t.preventDefault(),t=b(t),this._clearTouchTimer(),this._setMouseEventXY(t),this.options.onMouseMove(t)}},{key:"_onTouchEnd",value:function(t){t=b(t),this._clearTouchTimer(),this._setMouseEventXY(t),this.options.onMouseUp(t),Date.now()-this._startTime<100&&this.options.onClick(t)}},{key:"_onMouseOut",value:function(t){this._clearTouchTimer(),this.options.onMouseOut(t)}},{key:"_clearTouchTimer",value:function(){this._touchTimer&&clearTimeout(this._touchTimer)}},{key:"_setMouseEventXY",value:function(t){var e=function(t,e){if(void 0!==e.offsetX)return{x:e.offsetX,y:e.offsetY};if(void 0!==e.layerX&&e.layerX!==e.offsetX)return{x:e.layerX,y:e.layerY};var n=function(t){try{return t.getBoundingClientRect()}catch(t){return{left:0,top:0}}}(t);return{x:e.clientX-n.left,y:e.clientY-n.top}}(this.element,t),n=e.x,o=e.y;t.stageX=n,t.stageY=o}},{key:"detach",value:function(){this.element.removeEventListener(w.START,this._onTouchStart,!1),this.element.removeEventListener(w.MOVE,this._onTouchMove,!1),this.element.removeEventListener(w.END,this._onTouchEnd,!1),this.element.removeEventListener("mouseout",this._onMouseOut,!1)}}]),t}();T.defaultOptions={onMouseDown:g,onMouseMove:g,onMouseUp:g,onMouseOut:g,onClick:g,onLongTap:g};var O=T;var S=function(t){c(a,t);var e,n,i=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,o=s(e);if(n){var i=s(this).constructor;t=Reflect.construct(o,arguments,i)}else t=o.apply(this,arguments);return d(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,a),(t=i.call(this,e)).options=e,t._isStart=!1,t.standardLineWidth=10,t.standardSpeed=20,t.lastTimestamp=null,t.lastMouseX=null,t.lastMouseY=null,t.lastMoveToX=0,t.lastMoveToY=0,t}return r(a,[{key:"init",value:function(){var t=this.options.root;this.drawElement=document.createElement("canvas"),this.drawCtx=this.drawElement.getContext("2d"),t.appendChild(this.drawElement),u(s(a.prototype),"init",this).call(this),this.mouseEvent=new O({onMouseDown:this.handleMouseDown.bind(this),onMouseMove:this.handleMouseMove.bind(this),onMouseUp:this.handleMouseUp.bind(this),onMouseOut:this.handleMouseUp.bind(this)}),this.mouseEvent.attach(this.drawElement)}},{key:"destroy",value:function(){u(s(a.prototype),"destroy",this).call(this),this.mouseEvent.detach()}},{key:"handleMouseDown",value:function(t){this._isStart=!0,this.drawCtx.lineWidth=this.options.lineWidth,this.drawCtx.lineJoin="round",this.drawCtx.lineCap="round",this.drawCtx.strokeStyle=this.options.color,this.lastMoveToX=t.stageX,this.lastMoveToY=t.stageY,this.drawCtx.beginPath(),this.drawCtx.moveTo(t.stageX,t.stageY),this.drawCtx.lineTo(t.stageX+.1,t.stageY+.1),this.drawCtx.stroke()}},{key:"handleMouseMove",value:function(t){if(this._isStart){var e=this._calculateSpeed(t),n=this.options.lineWidth+(1-e/this.standardSpeed)*(this.options.lineWidth/this.standardLineWidth);this.drawCtx.lineWidth=Math.max(3,n),this.drawCtx.beginPath(),this.drawCtx.moveTo(this.lastMoveToX,this.lastMoveToY),this.drawCtx.lineTo(t.stageX,t.stageY),this.drawCtx.closePath(),this.drawCtx.stroke(),this.lastMoveToX=t.stageX,this.lastMoveToY=t.stageY}}},{key:"handleMouseUp",value:function(){var t=this;this._isStart=!1;var e=new Image;e.src=this.drawElement.toDataURL(),e.onload=function(){t.options.onDrawUp(e),t.drawCtx.clearRect(0,0,t.drawElement.width,t.drawElement.height),e.onload=null}}},{key:"setLineWidth",value:function(t){this.options.lineWidth=t}},{key:"setColor",value:function(t){this.options.color=t}},{key:"_calculateSpeed",value:function(t){if(null===this.lastTimestamp)return this.lastTimestamp=Date.now(),this.lastMouseX=t.stageX,this.lastMouseY=t.stageY,0;var e=Date.now(),n=e-this.lastTimestamp,o=Math.abs(t.stageX-this.lastMouseX),i=Math.abs(t.stageY-this.lastMouseY),r=Math.sqrt(o*o,i*i),a=Math.round(r/n*100);return this.lastTimestamp=e,this.lastMouseX=t.stageX,this.lastMouseY=t.stageY,a}}]),a}(M),_=S,R=function(){function t(){o(this,t),this._undoStack=[],this._redoStack=[]}return r(t,[{key:"push",value:function(t,e){var n=this;this._undoStack.push((function o(){t(),n._redoStack.push((function(){e(),n._undoStack.push(o)}))}))}},{key:"undo",value:function(){var t=this._undoStack.pop();t instanceof Function&&t()}},{key:"redo",value:function(){var t=this._redoStack.pop();t instanceof Function&&t()}},{key:"canUndo",value:function(){return this._undoStack.length>0}},{key:"canRedo",value:function(){return this._redoStack.length>0}},{key:"clear",value:function(){this._redoStack=[],this._undoStack=[]}}]),t}();function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function C(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?x(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):x(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var j=function(t){c(h,t);var e,n,i=(e=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,o=s(e);if(n){var i=s(this).constructor;t=Reflect.construct(o,arguments,i)}else t=o.apply(this,arguments);return d(this,t)});function h(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,h),(t=i.call(this,e)).options=C(C({},h.defaultOptions),e),t.drawStack=[],t.lastCanUndo=!1,t.lastCanRedo=!1,t.painter=new _(C(C({},t.options),{},{onDrawUp:t.onDrawUp.bind(a(t))})),t.undoRedoManager=new R,t.init(),t}return r(h,[{key:"init",value:function(){var t=this.options.root;if(this.drawElement=document.createElement("canvas"),this.drawCtx=this.drawElement.getContext("2d"),!(t&&t instanceof Element))throw new Error("Invalid root element.");t.style.position="relative",t.appendChild(this.drawElement),u(s(h.prototype),"init",this).call(this),this.painter.init(),this.handleUndoRedoStateChange(!0),this.tick()}},{key:"onDrawUp",value:function(t){var e=this,n=function(){e.drawStack.push(t)};this.undoRedoManager.push((function(){e.drawStack.pop()}),n),n(),this.options.onDrawUp&&this.options.onDrawUp(t),this.handleUndoRedoStateChange()}},{key:"tick",value:function(){var t=this;this.raf=requestAnimationFrame((function(){t.render(),t.tick()}))}},{key:"render",value:function(){var t=this,e=this.drawElement,n=e.width,o=e.height;this.drawCtx.clearRect(0,0,n,o),this.drawStack.forEach((function(e){t.drawCtx.drawImage(e,0,0,n,o)}))}},{key:"clear",value:function(){this.drawStack=[],this.undoRedoManager.clear(),this.handleUndoRedoStateChange()}},{key:"unTick",value:function(){this.raf&&cancelAnimationFrame(this.raf)}},{key:"setLineWidth",value:function(t){this.painter.setLineWidth(t)}},{key:"setColor",value:function(t){this.painter.setColor(t)}},{key:"handleUndoRedoStateChange",value:function(t){var e=this.canUndo(),n=this.canRedo();(t||this.lastCanUndo!==e)&&(this.options.undoRedoStateChange(e,n),this.lastCanUndo=e),(t||this.lastCanRedo!==n)&&(this.options.undoRedoStateChange(e,n),this.lastCanRedo=n)}},{key:"undo",value:function(){this.undoRedoManager.undo(),this.handleUndoRedoStateChange()}},{key:"redo",value:function(){this.undoRedoManager.redo(),this.handleUndoRedoStateChange()}},{key:"canUndo",value:function(){return this.undoRedoManager.canUndo()}},{key:"canRedo",value:function(){return this.undoRedoManager.canRedo()}},{key:"destroy",value:function(){u(s(h.prototype),"destroy",this).call(this),this.unTick(),this.painter.destroy(),this.undoRedoManager.clear()}},{key:"getResult",value:function(){for(var t=this.drawElement,e=t.width,n=t.height,o=this.drawCtx.getImageData(0,0,e,n).data,i=e,r=0,a=n,s=0,u=0;u<e;u++)for(var h=0;h<n;h++)o[4*(u+e*h)+3]>0&&(s=Math.max(h,s),r=Math.max(u,r),a=Math.min(h,a),i=Math.min(u,i));i++,r++,a++,s++;var c=document.createElement("canvas"),l=c.getContext("2d");c.width=r-i,c.height=s-a,l.drawImage(this.drawElement,i,a,c.width,c.height,0,0,c.width,c.height);var d=c.width,f=c.height,p=this.options,v=p.exportMaxWidth,y=p.exportMaxHeight,m=p.exportPadding;v&&v<d&&(f*=v/d,d=v),y&&y<f&&(d*=y/f,f=y);var w=document.createElement("canvas"),g=w.getContext("2d");return w.width=d,w.height=f,g.drawImage(c,m,m,w.width-2*m,w.height-2*m),w}},{key:"base64ToBlob",value:function(t){for(var e=t.split(";base64,"),n=e[0].split(":")[1],o=window.atob(e[1]),i=o.length,r=new Uint8Array(i),a=0;a<i;++a)r[a]=o.charCodeAt(a);return new Blob([r],{type:n})}},{key:"downloadFile",value:function(){var t=Date.now(),e=document.createElement("a"),n=this.base64ToBlob(this.drawElement.toDataURL()),o=URL.createObjectURL(n);document.createEvent("HTMLEvents").initEvent("click",!0,!0),e.download=t,e.href=o,e.click(),window.URL.revokeObjectURL(o),e=null,o=null}}]),h}(M);j.defaultOptions={root:null,width:"auto",height:"auto",color:"#333",lineWidth:8,exportPadding:0,exportMaxWidth:null,exportMaxHeight:null,undoRedoStateChange:g};var D=j;return e}()}));